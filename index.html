<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <title>GPT-2 в браузере</title>
  <style>
    body { font-family: sans-serif; margin: 2em; background: #f0f0f0; }
    textarea { width: 100%; height: 100px; }
    button { margin-top: 10px; padding: 10px 20px; }
    #answer { margin-top: 20px; background: #fff; padding: 15px; border: 1px solid #ccc; }
    #status { color: #666; font-style: italic; }
  </style>
</head>
<body>
  <h2>Христианский чат-бот (GPT-2 в браузере)</h2>
  <div id="status">Загрузка модели... (50 МБ, один раз)</div>
  <textarea id="prompt" placeholder="Задай вопрос..."></textarea><br>
  <button onclick="generateText()">Ответить</button>
  <div id="answer">Здесь будет ответ...</div>

  <script>
    let gpt2;
    const modelUrl = "https://unpkg.com/gpt4all-ts@0.1.2/dist/gpt4all/gpt2-medium-quantized-ggml.bin";

    async function loadModel() {
      const { GPT4All } = await import("https://unpkg.com/gpt4all-ts@0.1.2/dist/gpt4all.min.js");
      gpt2 = new GPT4All(modelUrl, {
        onLoadProgress: (progress) => {
          document.getElementById("status").textContent = `Загрузка: ${Math.round(progress * 100)}%`;
        }
      });
      await gpt2.init();
      document.getElementById("status").textContent = "Модель готова!";
    }

    async function generateText() {
      const prompt = document.getElementById("prompt").value;
      document.getElementById("answer").textContent = "Генерирую ответ...";
      
      const response = await gpt2.generate(`
        Ты — христианский наставник. Отвечай кратко и по делу, цитируя Библию.
        Вопрос: ${prompt}
        Ответ:
      `, { maxTokens: 100 });
      
      document.getElementById("answer").textContent = response;
    }

    loadModel(); // Загружаем модель при открытии страницы
  </script>
</body>
</html>
