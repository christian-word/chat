<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <title>–ì–æ–ª–æ—Å –≤ —Ç–µ–∫—Å—Ç (–ª–æ–∫–∞–ª—å–Ω–∞—è –≤–µ—Ä—Å–∏—è)</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 100%;
            padding: 15px;
            margin: 0;
        }
        #status {
            padding: 10px;
            margin: 10px 0;
            border-radius: 5px;
            background: #f8f9fa;
        }
        .error {
            background: #ffebee;
            color: #d32f2f;
        }
        .success {
            background: #e8f5e9;
            color: #2e7d32;
        }
        button {
            width: 100%;
            padding: 12px;
            margin: 5px 0;
            background: #4285f4;
            color: white;
            border: none;
            border-radius: 5px;
            font-size: 16px;
        }
        button:disabled {
            background: #cccccc;
        }
        textarea {
            width: 100%;
            height: 120px;
            padding: 10px;
            margin: 10px 0;
            border: 1px solid #ddd;
            border-radius: 5px;
        }
        .instructions {
            font-size: 14px;
            color: #666;
            margin: 15px 0;
        }
    </style>
</head>
<body>
    <h2>–ì–æ–ª–æ—Å –≤ —Ç–µ–∫—Å—Ç</h2>
    <div id="status">–ì–æ—Ç–æ–≤ –∫ —Ä–∞–±–æ—Ç–µ</div>
    
    <div class="instructions">
        <strong>–ö–∞–∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å:</strong>
        <ol>
            <li>–ù–∞–∂–º–∏—Ç–µ "–ù–∞—á–∞—Ç—å –∑–∞–ø–∏—Å—å"</li>
            <li>–†–∞–∑—Ä–µ—à–∏—Ç–µ –¥–æ—Å—Ç—É–ø –∫ –º–∏–∫—Ä–æ—Ñ–æ–Ω—É</li>
            <li>–ì–æ–≤–æ—Ä–∏—Ç–µ —á–µ—Ç–∫–æ –≤ –º–∏–∫—Ä–æ—Ñ–æ–Ω</li>
        </ol>
    </div>
    
    <textarea id="text" placeholder="–¢–µ–∫—Å—Ç –ø–æ—è–≤–∏—Ç—Å—è –∑–¥–µ—Å—å..."></textarea>
    <button id="startBtn">–ù–∞—á–∞—Ç—å –∑–∞–ø–∏—Å—å</button>
    <button id="stopBtn" disabled>–û—Å—Ç–∞–Ω–æ–≤–∏—Ç—å</button>

    <script>
        const startBtn = document.getElementById('startBtn');
        const stopBtn = document.getElementById('stopBtn');
        const statusEl = document.getElementById('status');
        const textArea = document.getElementById('text');
        
        let recognition;
        let isRecording = false;

        // –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–¥–¥–µ—Ä–∂–∫–∏ API
        function checkSupport() {
            if (!('webkitSpeechRecognition' in window)) {
                statusEl.textContent = '–í–∞—à –±—Ä–∞—É–∑–µ—Ä –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç —Ä–∞—Å–ø–æ–∑–Ω–∞–≤–∞–Ω–∏–µ —Ä–µ—á–∏';
                statusEl.className = 'error';
                startBtn.disabled = true;
                return false;
            }
            return true;
        }

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è —Ä–∞—Å–ø–æ–∑–Ω–∞–≤–∞–Ω–∏—è
        function initRecognition() {
            recognition = new webkitSpeechRecognition();
            recognition.continuous = true;
            recognition.interimResults = true;
            recognition.lang = 'ru-RU';
            
            recognition.onstart = () => {
                isRecording = true;
                statusEl.textContent = '–ò–¥–µ—Ç –∑–∞–ø–∏—Å—å...';
                statusEl.className = 'success';
                startBtn.disabled = true;
                stopBtn.disabled = false;
            };
            
            recognition.onerror = (event) => {
                let message = '–û—à–∏–±–∫–∞: ';
                if (event.error === 'not-allowed') {
                    message += '–î–æ—Å—Ç—É–ø –∫ –º–∏–∫—Ä–æ—Ñ–æ–Ω—É –∑–∞–ø—Ä–µ—â–µ–Ω. ';
                    if (window.chrome) {
                        message += '–í –∞–¥—Ä–µ—Å–Ω–æ–π —Å—Ç—Ä–æ–∫–µ –Ω–∞–∂–º–∏—Ç–µ –Ω–∞ –∏–∫–æ–Ω–∫—É üîí –∏ —Ä–∞–∑—Ä–µ—à–∏—Ç–µ –º–∏–∫—Ä–æ—Ñ–æ–Ω.';
                    } else {
                        message += '–û–±–Ω–æ–≤–∏—Ç–µ —Å—Ç—Ä–∞–Ω–∏—Ü—É –∏ —Ä–∞–∑—Ä–µ—à–∏—Ç–µ –¥–æ—Å—Ç—É–ø.';
                    }
                } else {
                    message += event.error;
                }
                showError(message);
                stopRecording();
            };
            
            recognition.onresult = (event) => {
                let interim = '';
                for (let i = event.resultIndex; i < event.results.length; i++) {
                    if (event.results[i].isFinal) {
                        textArea.value += event.results[i][0].transcript + '\n';
                    } else {
                        interim += event.results[i][0].transcript;
                    }
                }
                if (interim) {
                    textArea.value = textArea.value.replace(/\n$/, '') + interim;
                }
            };
            
            recognition.onend = () => {
                if (isRecording) {
                    recognition.start(); // –ê–≤—Ç–æ–ø–µ—Ä–µ–∑–∞–ø—É—Å–∫
                }
            };
        }

        // –ü–æ–∫–∞–∑–∞—Ç—å –æ—à–∏–±–∫—É
        function showError(message) {
            statusEl.textContent = message;
            statusEl.className = 'error';
            console.error(message);
        }

        // –û—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–ø–∏—Å–∏
        function stopRecording() {
            isRecording = false;
            if (recognition) {
                recognition.stop();
            }
            startBtn.disabled = false;
            stopBtn.disabled = true;
            statusEl.textContent = '–ì–æ—Ç–æ–≤ –∫ —Ä–∞–±–æ—Ç–µ';
            statusEl.className = '';
        }

        // –û—Å–Ω–æ–≤–Ω–∞—è –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
        document.addEventListener('DOMContentLoaded', () => {
            if (!checkSupport()) return;
            
            initRecognition();
            
            startBtn.addEventListener('click', () => {
                if (!isRecording) {
                    textArea.value = '';
                    try {
                        recognition.start();
                    } catch(e) {
                        showError('–û—à–∏–±–∫–∞ –∑–∞–ø—É—Å–∫–∞: ' + e.message);
                    }
                }
            });
            
            stopBtn.addEventListener('click', stopRecording);
        });
    </script>
</body>
</html>
