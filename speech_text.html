<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <title>–ì–æ–ª–æ—Å –≤ —Ç–µ–∫—Å—Ç —Å –ø–æ–ª–Ω—ã–º —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª–æ–º</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 100%;
            padding: 15px;
            margin: 0;
            line-height: 1.5;
        }
        #status {
            padding: 10px;
            margin: 10px 0;
            border-radius: 5px;
            background: #f8f9fa;
        }
        .error {
            background: #ffebee;
            color: #d32f2f;
        }
        .success {
            background: #e8f5e9;
            color: #2e7d32;
        }
        .btn {
            width: 100%;
            padding: 12px;
            margin: 5px 0;
            border: none;
            border-radius: 5px;
            font-size: 16px;
            cursor: pointer;
        }
        .btn-primary {
            background: #4285f4;
            color: white;
        }
        .btn-danger {
            background: #ea4335;
            color: white;
        }
        .btn-secondary {
            background: #f1f3f4;
            color: #202124;
        }
        button:disabled {
            background: #cccccc;
            cursor: not-allowed;
        }
        textarea {
            width: 100%;
            height: 150px;
            padding: 10px;
            margin: 10px 0;
            border: 1px solid #ddd;
            border-radius: 5px;
            font-family: inherit;
            font-size: 16px;
            resize: vertical;
        }
        .button-group {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
            margin: 10px 0;
        }
        .instructions {
            font-size: 14px;
            color: #666;
            margin: 15px 0;
        }
        .icon {
            margin-right: 8px;
        }
    </style>
</head>
<body>
    <h2>–ì–æ–ª–æ—Å –≤ —Ç–µ–∫—Å—Ç</h2>
    <div id="status">–ì–æ—Ç–æ–≤ –∫ —Ä–∞–±–æ—Ç–µ</div>
    
    <div class="instructions">
        <strong>–ö–∞–∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å:</strong>
        <ol>
            <li>–ù–∞–∂–º–∏—Ç–µ "–ù–∞—á–∞—Ç—å –∑–∞–ø–∏—Å—å"</li>
            <li>–†–∞–∑—Ä–µ—à–∏—Ç–µ –¥–æ—Å—Ç—É–ø –∫ –º–∏–∫—Ä–æ—Ñ–æ–Ω—É</li>
            <li>–ì–æ–≤–æ—Ä–∏—Ç–µ —á–µ—Ç–∫–æ –≤ –º–∏–∫—Ä–æ—Ñ–æ–Ω</li>
        </ol>
    </div>
    
    <textarea id="text" placeholder="–¢–µ–∫—Å—Ç –ø–æ—è–≤–∏—Ç—Å—è –∑–¥–µ—Å—å..."></textarea>
    
    <button id="startBtn" class="btn btn-primary">
        <span class="icon">üé§</span>–ù–∞—á–∞—Ç—å –∑–∞–ø–∏—Å—å
    </button>
    <button id="stopBtn" class="btn btn-danger" disabled>
        <span class="icon">‚èπ</span>–û—Å—Ç–∞–Ω–æ–≤–∏—Ç—å
    </button>
    
    <div class="button-group">
        <button id="clearBtn" class="btn btn-secondary">
            <span class="icon">‚ùå</span>–û—á–∏—Å—Ç–∏—Ç—å
        </button>
        <button id="copyBtn" class="btn btn-secondary">
            <span class="icon">‚éò</span>–ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å
        </button>
        <button id="saveBtn" class="btn btn-secondary">
            <span class="icon">üíæ</span>–°–æ—Ö—Ä–∞–Ω–∏—Ç—å
        </button>
    </div>

    <script>
        const startBtn = document.getElementById('startBtn');
        const stopBtn = document.getElementById('stopBtn');
        const clearBtn = document.getElementById('clearBtn');
        const copyBtn = document.getElementById('copyBtn');
        const saveBtn = document.getElementById('saveBtn');
        const statusEl = document.getElementById('status');
        const textArea = document.getElementById('text');
        
        let recognition;
        let isRecording = false;
        let lastTextLength = 0;

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è —Ä–∞—Å–ø–æ–∑–Ω–∞–≤–∞–Ω–∏—è
        function initRecognition() {
            recognition = new (window.SpeechRecognition || window.webkitSpeechRecognition)();
            recognition.continuous = true;
            recognition.interimResults = true;
            recognition.lang = 'ru-RU';
            
            recognition.onstart = () => {
                isRecording = true;
                statusEl.textContent = '–ò–¥–µ—Ç –∑–∞–ø–∏—Å—å...';
                statusEl.className = 'success';
                startBtn.disabled = true;
                stopBtn.disabled = false;
                lastTextLength = 0;
            };
            
            recognition.onerror = (event) => {
                let message = '–û—à–∏–±–∫–∞: ';
                if (event.error === 'not-allowed') {
                    message += '–î–æ—Å—Ç—É–ø –∫ –º–∏–∫—Ä–æ—Ñ–æ–Ω—É –∑–∞–ø—Ä–µ—â–µ–Ω. ';
                    if (window.chrome) {
                        message += '–í –∞–¥—Ä–µ—Å–Ω–æ–π —Å—Ç—Ä–æ–∫–µ –Ω–∞–∂–º–∏—Ç–µ –Ω–∞ –∏–∫–æ–Ω–∫—É üîí –∏ —Ä–∞–∑—Ä–µ—à–∏—Ç–µ –º–∏–∫—Ä–æ—Ñ–æ–Ω.';
                    } else {
                        message += '–û–±–Ω–æ–≤–∏—Ç–µ —Å—Ç—Ä–∞–Ω–∏—Ü—É –∏ —Ä–∞–∑—Ä–µ—à–∏—Ç–µ –¥–æ—Å—Ç—É–ø.';
                    }
                } else {
                    message += event.error;
                }
                showError(message);
                stopRecording();
            };
            
            recognition.onresult = (event) => {
                let final = '';
                let interim = '';
                
                for (let i = event.resultIndex; i < event.results.length; i++) {
                    const transcript = event.results[i][0].transcript;
                    if (event.results[i].isFinal) {
                        final += transcript;
                    } else {
                        interim += transcript;
                    }
                }
                
                // –§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Ç–µ–∫—Å—Ç–∞ –±–µ–∑ "–ø–∏—Ä–∞–º–∏–¥"
                if (final) {
                    textArea.value = textArea.value.substring(0, lastTextLength) + final + '\n';
                    lastTextLength = textArea.value.length;
                }
                
                if (interim) {
                    textArea.value = textArea.value.substring(0, lastTextLength) + interim;
                }
                
                textArea.scrollTop = textArea.scrollHeight;
            };
            
            recognition.onend = () => {
                if (isRecording) {
                    recognition.start();
                }
            };
        }

        // –ü–æ–∫–∞–∑–∞—Ç—å –æ—à–∏–±–∫—É
        function showError(message) {
            statusEl.textContent = message;
            statusEl.className = 'error';
            console.error(message);
        }

        // –û—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–ø–∏—Å–∏
        function stopRecording() {
            isRecording = false;
            if (recognition) {
                recognition.stop();
            }
            startBtn.disabled = false;
            stopBtn.disabled = true;
            statusEl.textContent = '–ì–æ—Ç–æ–≤ –∫ —Ä–∞–±–æ—Ç–µ';
            statusEl.className = '';
        }

        // –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–¥–¥–µ—Ä–∂–∫–∏ API
        function checkSupport() {
            if (!('SpeechRecognition' in window || 'webkitSpeechRecognition' in window)) {
                statusEl.textContent = '–í–∞—à –±—Ä–∞—É–∑–µ—Ä –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç —Ä–∞—Å–ø–æ–∑–Ω–∞–≤–∞–Ω–∏–µ —Ä–µ—á–∏';
                statusEl.className = 'error';
                startBtn.disabled = true;
                return false;
            }
            return true;
        }

        // –û—Å–Ω–æ–≤–Ω–∞—è –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
        document.addEventListener('DOMContentLoaded', () => {
            if (!checkSupport()) return;
            
            initRecognition();
            
            // –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –∫–Ω–æ–ø–æ–∫
            startBtn.addEventListener('click', () => {
                if (!isRecording) {
                    textArea.value = '';
                    try {
                        recognition.start();
                    } catch(e) {
                        showError('–û—à–∏–±–∫–∞ –∑–∞–ø—É—Å–∫–∞: ' + e.message);
                    }
                }
            });
            
            stopBtn.addEventListener('click', stopRecording);
            
            clearBtn.addEventListener('click', () => {
                textArea.value = '';
                lastTextLength = 0;
            });
            
            copyBtn.addEventListener('click', () => {
                textArea.select();
                document.execCommand('copy');
                statusEl.textContent = '–¢–µ–∫—Å—Ç —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω –≤ –±—É—Ñ–µ—Ä';
                statusEl.className = 'success';
                setTimeout(() => {
                    statusEl.textContent = '–ì–æ—Ç–æ–≤ –∫ —Ä–∞–±–æ—Ç–µ';
                    statusEl.className = '';
                }, 2000);
            });
            
            saveBtn.addEventListener('click', () => {
                const blob = new Blob([textArea.value], { type: 'text/plain' });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = '—Ç–µ–∫—Å—Ç_' + new Date().toISOString().slice(0, 10) + '.txt';
                a.click();
                URL.revokeObjectURL(url);
            });
        });
    </script>
</body>
</html>
