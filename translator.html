
<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <title>–ì–æ–ª–æ—Å–æ–≤–æ–π –æ–∑–≤—É—á–∏–≤–∞—Ç–µ–ª—å</title>
  <style>
    body {
      font-family: sans-serif;
      padding: 1em;
      background: #f5f5f5;
    }
    textarea {
      width: 100%;
      height: 100px;
      font-size: 1em;
      padding: 0.5em;
      margin-bottom: 0.5em;
    }
    select, input[type=range], button {
      width: 100%;
      margin: 0.3em 0;
      padding: 0.5em;
      font-size: 1em;
    }
    #log {
      max-height: 150px;
      overflow-y: auto;
      background: #fff;
      padding: 0.5em;
      margin-top: 1em;
      border: 1px solid #ccc;
    }
    .entry {
      padding: 0.2em 0;
      border-bottom: 1px solid #eee;
    }
  </style>
</head>
<body>
  <h2>üéôÔ∏è –†–∞—Å–ø–æ–∑–Ω–∞–≤–∞–Ω–∏–µ –∏ –û–∑–≤—É—á–∫–∞</h2>

  <textarea id="text" placeholder="–ù–∞–∂–º–∏—Ç–µ '–ì–æ–≤–æ—Ä–∏—Ç—å', —á—Ç–æ–±—ã –Ω–∞—á–∞—Ç—å..."></textarea>

  <button onclick="startRecognition()">üé§ –ì–æ–≤–æ—Ä–∏—Ç—å</button>
  <button onclick="speak()">üîä –û–∑–≤—É—á–∏—Ç—å</button>

  <label for="voice">–ì–æ–ª–æ—Å:</label>
  <select id="voice"></select>

  <label>–°–∫–æ—Ä–æ—Å—Ç—å: <span id="rate-val">1</span></label>
  <input type="range" id="rate" min="0.5" max="2" step="0.1" value="1">

  <label>–¢–æ–Ω: <span id="pitch-val">1</span></label>
  <input type="range" id="pitch" min="0" max="2" step="0.1" value="1">

  <div id="log"></div>

  <script>
    const voiceSelect = document.getElementById('voice');
    const rateInput = document.getElementById('rate');
    const pitchInput = document.getElementById('pitch');
    const rateVal = document.getElementById('rate-val');
    const pitchVal = document.getElementById('pitch-val');
    const log = document.getElementById('log');
    const textArea = document.getElementById('text');

    function populateVoices() {
      const voices = speechSynthesis.getVoices();
      voiceSelect.innerHTML = '';
      voices.forEach((voice, i) => {
        const option = document.createElement('option');
        option.value = i;
        option.textContent = `${voice.name} (${voice.lang})${voice.default ? ' [–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é]' : ''}`;
        voiceSelect.appendChild(option);
      });
    }

function speak() {
  const text = document.getElementById('text').value.trim();
  if (!text) return;

  const utterance = new SpeechSynthesisUtterance(text);
  const voices = speechSynthesis.getVoices();

  // –ï—Å–ª–∏ –≥–æ–ª–æ—Å–æ–≤ –Ω–µ—Ç ‚Äî –ø—Ä–æ–±—É–µ–º –ø–æ–∑–∂–µ
  if (!voices.length) {
    alert('–ì–æ–ª–æ—Å–∞ –Ω–µ –∑–∞–≥—Ä—É–∂–µ–Ω—ã. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –µ—â—ë —Ä–∞–∑.');
    return;
  }

  const selectedVoice = voices[voiceSelect.value];
  if (selectedVoice) {
    utterance.voice = selectedVoice;
  }

  utterance.rate = parseFloat(rateInput.value);
  utterance.pitch = parseFloat(pitchInput.value);

  speechSynthesis.speak(utterance);
  addToLog(text);
}


    function addToLog(text) {
      const div = document.createElement('div');
      div.className = 'entry';
      div.textContent = text;
      log.appendChild(div);
      log.scrollTop = log.scrollHeight;
    }

    function startRecognition() {
      const recognition = new (window.SpeechRecognition || window.webkitSpeechRecognition)();
      recognition.lang = 'ru-RU'; // –º–æ–∂–Ω–æ –ø–æ—Å—Ç–∞–≤–∏—Ç—å 'en-US' –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
      recognition.interimResults = false;
      recognition.maxAlternatives = 1;

      recognition.onresult = (event) => {
        const result = event.results[0][0].transcript;
        textArea.value = result;
        addToLog("üéß " + result);
      };

      recognition.onerror = (event) => {
        alert('–û—à–∏–±–∫–∞ —Ä–∞—Å–ø–æ–∑–Ω–∞–≤–∞–Ω–∏—è: ' + event.error);
      };

      recognition.start();
    }

    speechSynthesis.onvoiceschanged = populateVoices;
    populateVoices();

    rateInput.oninput = () => rateVal.textContent = rateInput.value;
    pitchInput.oninput = () => pitchVal.textContent = pitchInput.value;
  </script>
</body>
</html>
